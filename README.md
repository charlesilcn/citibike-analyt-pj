# Citi Bike 数据分析项目

## 项目概述

本项目对 Citi Bike 共享单车系统的数据进行全面分析，涵盖时间维度、空间维度和用户行为维度等多个方面。通过对 2023-2025 年的数据进行清洗、合并和深入分析，我们旨在理解共享单车的使用模式、高峰时段、热门站点以及用户行为特征，为 Citi Bike 系统的优化提供数据支持和业务建议。

## 文件目录结构

```
d:\code\502\Bike A/
├── README.md              # 项目说明文档
├── analyze_csv.py         # CSV分析脚本
├── clean_csv.py           # 数据清洗脚本
├── csv_to_parquet.py      # CSV转Parquet格式脚本
├── data_analysis.py       # 主要数据分析脚本
├── logs/                  # 日志文件目录
│   ├── 23cleaning_log.txt     # 2023年数据清洗日志
│   ├── 24cleaning_log.txt     # 2024年数据清洗日志
│   ├── 25cleaning_log.txt     # 2025年数据清洗日志
│   └── exp.txt                # 实验日志
├── merge_csv.py           # CSV文件合并脚本
├── merged_data/           # 合并和清洗后的数据
│   ├── cleaned_2023_data.csv  # 2023年清洗后数据
│   ├── cleaned_2024_data.csv  # 2024年清洗后数据
│   ├── cleaned_2025_data.csv  # 2025年清洗后数据
│   ├── merged_2023_data.csv   # 2023年合并数据
│   ├── merged_2024_data.csv   # 2024年合并数据
│   └── merged_2025_data.csv   # 2025年合并数据
├── requirements.txt       # 项目依赖包列表
├── result/                # 分析结果和报告
│   ├── 23/                # 2023年分析结果
│   │   ├── analysis_results.json       # 分析结果JSON
│   │   ├── analysis_summary_report.md  # 分析报告
│   │   └── visualizations/             # 可视化图表
│   ├── 24/                # 2024年分析结果
│   │   ├── analysis_results.json       # 分析结果JSON
│   │   ├── analysis_summary_report.md  # 分析报告
│   │   └── visualizations/             # 可视化图表
│   ├── 25/                # 2025年分析结果
│   │   ├── analysis_results.json       # 分析结果JSON
│   │   ├── analysis_summary_report.md  # 分析报告
│   │   └── visualizations/             # 可视化图表
│   └── charts/            # 专项分析图表
│       ├── 2023_seasonal_analysis/      # 2023年季节性分析图表
│       ├── 2024_seasonal_analysis/      # 2024年季节性分析图表
│       ├── 2025_seasonal_analysis/      # 2025年季节性分析图表
│       └── 2024_rush_hour_enhanced/     # 2024年高峰时段增强分析图表
├── rush_hour_identification_enhanced.py # 高峰时段识别增强版脚本
├── seasonal_analysis.py   # 季节性分析脚本
├── user analysis/         # 用户分析相关文件
└── user_type_analysis.py  # 用户类型分析脚本
```

## 代码功能说明

### 1. 数据处理流程

#### merge_csv.py
- **功能**：将指定目录下的多个CSV文件合并为单个文件
- **主要函数**：`merge_csv_files()` - 遍历目录中的所有CSV文件，读取并合并数据
- **输出**：合并后的CSV文件（如merged_2024_data.csv）

#### clean_csv.py
- **功能**：对合并后的数据进行清洗，处理异常值、缺失值和数据类型转换
- **主要步骤**：
  - 删除重复行
  - 转换和验证日期时间列
  - 筛选合理的骑行时长（1分钟到24小时）
  - 处理地理位置异常值
  - 处理缺失的站点信息
  - 验证用户类型和车辆类型
- **输出**：清洗后的数据文件（如cleaned_2024_data.csv）和清洗日志

#### csv_to_parquet.py
- **功能**：将CSV文件转换为Parquet格式，提高大数据集的读取效率
- **主要函数**：`csv_to_parquet()` - 读取CSV文件并转换为Parquet格式
- **输出**：Parquet格式的数据文件

### 2. 数据分析功能

#### data_analysis.py
- **功能**：对清洗后的数据进行多维度分析，生成可视化图表和分析报告
- **主要类**：`BikeDataAnalyzer` - 包含数据加载、预处理、分析和可视化的完整功能
- **主要分析维度**：
  - 时间维度分析：每日高峰时段、工作日vs周末比较、月度趋势
  - 空间维度分析：热门起点/终点、站点使用模式
  - 用户行为分析：骑行时长分布、用户类型（会员vs临时用户）行为差异
  - 车型维度分析：不同车型的使用情况比较

`BikeDataAnalyzer` 类的主要方法：

- `load_data()` - 加载数据，支持大数据集采样
- `preprocess_data()` - 数据预处理，包括特征提取和异常值处理
- `analyze_time_dimension()` - 时间维度分析
- `analyze_space_dimension()` - 空间维度分析
- `analyze_user_behavior()` - 用户行为分析
- `analyze_vehicle_type()` - 车型分析
- `generate_report()` - 生成分析报告
- `save_figure()` - 保存可视化图表

#### rush_hour_identification_enhanced.py
- **功能**：增强版高峰时段识别分析，支持大数据集分段处理
- **主要特性**：
  - 分段处理：支持每100万行数据为一段进行处理，避免内存溢出
  - 强制标记工作日早/晚高峰（7-9点早高峰，17-19点晚高峰）
  - 周末高峰时段自动识别（10-18点内的集中时段）
  - 多维度高峰分析：整体高峰、按用户类型、按区域类型
  - 实时进度显示和性能计时
- **主要函数**：
  - `load_data()` - 分段加载数据，支持大数据集处理
  - `identify_peak_periods()` - 识别高峰时段
  - `analyze_overall_rush_hour()` - 整体高峰分析
  - `analyze_user_type_rush_hour()` - 用户类型高峰分析
  - `analyze_area_rush_hour()` - 区域类型高峰分析
- **输出**：高峰时段分析图表和详细报告

#### seasonal_analysis.py
- **功能**：季节性骑行数据分析，探索不同季节的骑行模式
- **主要特性**：
  - 分段处理：支持大型数据集的分块加载和处理
  - 季节性特征分析：春季、夏季、秋季、冬季的骑行模式比较
  - 路线和时段分析：不同季节的热门路线和高峰时段
  - 支持大规模数据处理（4300万行数据集）
- **主要函数**：
  - `load_data()` - 分段加载数据，支持大数据集处理
  - `analyze_seasonal_rides()` - 季节性骑行量分析
  - `analyze_seasonal_routes()` - 季节性热门路线分析
  - `analyze_seasonal_rush_hour()` - 季节性高峰时段分析
- **输出**：季节性分析图表和结果数据

#### user_type_analysis.py
- **功能**：用户类型深度分析，比较会员和临时用户的行为差异
- **主要特性**：
  - 用户类型行为模式对比
  - 骑行时长、频率和时段偏好分析
  - 空间使用模式差异分析
- **输出**：用户类型分析报告和可视化图表

## 项目依赖

项目所需的主要Python包已在requirements.txt中列出，包括：
- pandas - 数据处理和分析
- numpy - 数值计算
- matplotlib - 数据可视化
- seaborn - 高级统计图表
- geopy - 地理距离计算

## 使用方法

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 数据处理流程

#### 数据合并
- 修改 `merge_csv.py` 中的 `source_dir` 和 `output_file` 变量，设置正确的源目录和输出文件路径
- 运行合并脚本：`python merge_csv.py`

#### 数据清洗
- 修改 `clean_csv.py` 中的 `input_file` 和 `output_file` 变量，指向合并后的数据文件
- 运行清洗脚本：`python clean_csv.py`

#### 数据格式转换（可选）
- 修改 `csv_to_parquet.py` 中的输入输出路径
- 运行转换脚本：`python csv_to_parquet.py`

### 3. 数据分析流程

#### 主要数据分析
- 修改 `data_analysis.py` 中的 `DEFAULT_CONFIG` 字典，设置正确的输入文件路径
- 运行分析脚本：`python data_analysis.py`

#### 高峰时段分析
- 修改 `rush_hour_identification_enhanced.py` 中的 `featured_path` 变量，指向清洗后的数据文件
- 运行分析脚本：`python rush_hour_identification_enhanced.py`
- 支持大数据集处理，自动分段加载（每100万行一段）

#### 季节性分析
- 修改 `seasonal_analysis.py` 中的路径配置，指向正确的数据文件和输出目录
- 运行分析脚本：`python seasonal_analysis.py`
- 支持大规模数据集处理，自动分段加载

#### 用户类型分析
- 修改 `user_type_analysis.py` 中的配置参数
- 运行分析脚本：`python user_type_analysis.py`

### 4. 分析结果查看

#### 主要分析结果
- 分析报告将保存在 `result/年份/analysis_summary_report.md`
- 可视化图表将保存在 `result/年份/visualizations/` 目录中
- 详细的分析数据将保存在 `result/年份/analysis_results.json`

#### 专项分析结果
- 高峰时段分析图表和报告：`result/charts/年份_rush_hour_enhanced/`
- 季节性分析图表：`result/charts/年份_seasonal_analysis/`

## 数据分析结果与洞察

### 关键发现

通过对Citi Bike 2023-2025年数据的全面分析，我们发现了以下关键模式和趋势：

1. **季节性骑行模式** - 夏季骑行量最高（约295,000次），冬季最低（约93,000次），显示出明显的季节性波动
2. **高峰时段特征** - 工作日固定出现早高峰（7-9点）和晚高峰（17-19点），周末高峰时段集中在10-18点
3. **用户行为差异** - 会员用户主要在工作日高峰时段使用，临时用户更多在周末骑行
4. **区域使用模式** - 商业区站点在工作日高峰更活跃，住宅区站点在周末使用更频繁
5. **数据规模** - 系统成功处理了大规模数据集（超过4300万行），验证了分段处理方法的有效性

### 业务建议

基于数据分析结果，我们提出以下业务优化建议：

### 1. 季节性资源调配

- **动态车辆部署** - 根据季节调整车辆分布，夏季增加20-30%的运营车辆，冬季优化车辆配置
- **季节性定价策略** - 在旺季实施动态定价，淡季推出促销活动平衡需求
- **天气响应机制** - 建立基于天气预报的车辆预调配系统，提前应对极端天气

### 2. 高峰时段管理

- **智能调度系统** - 工作日早7点前将车辆预调配到住宅区周边，晚17点前调配到商业区周边
- **高峰溢价策略** - 在7-9点和17-19点实施轻微溢价（10-15%），鼓励错峰出行
- **用户激励计划** - 开发"错峰出行奖励"，为非高峰时段骑行的用户提供积分或折扣

### 3. 用户分层运营

- **会员专属服务** - 为会员用户提供高峰期车辆优先预订服务
- **临时用户体验优化** - 针对周末和旅游季节，在热门景点周边增加临时用户友好的站点配置
- **用户转化策略** - 基于临时用户的使用模式，开发个性化的会员转化方案

### 4. 站点网络优化

- **数据驱动选址** - 基于骑行热力图和流量分析，优化新站点选址
- **站点容量调整** - 根据季节性和时段需求，动态调整站点容量和车辆配置
- **多模式交通整合** - 加强与公共交通系统的整合，在地铁和公交站点周边优化共享单车站点布局

### 5. 技术基础设施升级

- **大数据分析平台** - 建立实时数据分析平台，支持动态运营决策
- **预测模型部署** - 实施机器学习模型预测未来24-48小时的骑行需求
- **移动应用优化** - 为用户提供更准确的车辆可用性预测和智能路线规划

## 技术实现亮点

1. **大数据处理能力** - 实现了高效的分段数据处理机制，支持处理超过4300万行的大规模数据集
2. **并行分析架构** - 采用模块化设计，支持不同分析维度的并行处理
3. **可视化优化** - 开发了美观且信息丰富的数据可视化图表，支持直观的数据解读
4. **可扩展设计** - 系统架构支持未来数据规模的增长和分析维度的扩展
5. **实时性能监控** - 集成了性能计时和进度跟踪功能，提高开发和调试效率

## 结论

通过对Citi Bike 2023-2025年数据的全面分析，我们深入了解了共享单车系统的运营模式、用户行为和季节性特征。项目成功实现了大规模数据处理能力，通过分段加载和处理技术，有效解决了大数据集分析的内存和性能挑战。

数据分析结果揭示了明显的季节性模式、高峰时段特征和用户行为差异，为业务优化提供了数据支持。通过实施季节性资源调配、智能高峰管理、用户分层运营和数据驱动的站点优化，可以显著提升系统效率和用户体验。

本项目展示了数据驱动决策在共享出行领域的巨大价值，为Citi Bike系统的持续优化提供了科学依据和技术支持。未来可进一步扩展分析维度，整合更多外部数据（如天气、交通事件等），开发更精准的预测模型和智能调度系统，推动共享出行行业的数字化转型。
